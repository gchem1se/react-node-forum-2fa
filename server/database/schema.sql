BEGIN TRANSACTION;
DROP TABLE IF EXISTS "user";
CREATE TABLE IF NOT EXISTS "user" (
	"id"	INTEGER,
	"username"	TEXT NOT NULL UNIQUE,
	"email"	TEXT NOT NULL UNIQUE,
	"password_hash"	TEXT NOT NULL,
	"salt"	TEXT NOT NULL UNIQUE,
	"totp_secret"	TEXT,
	"is_admin"	INTEGER NOT NULL DEFAULT 0 CHECK("is_admin" == 0 || "is_admin" == 1),
	PRIMARY KEY("id" AUTOINCREMENT)
);
DROP TABLE IF EXISTS "comment";
CREATE TABLE IF NOT EXISTS "comment" (
	"id"	INTEGER,
	"author_id"	INTEGER,
	"post_id"	INTEGER NOT NULL,
	"pub_timestamp"	INTEGER NOT NULL CHECK("pub_timestamp" >= 0),
	"text"	TEXT NOT NULL CHECK(length("text") > 0),
	FOREIGN KEY("author_id") REFERENCES "user"("id") ON UPDATE CASCADE ON DELETE NO ACTION,
	FOREIGN KEY("post_id") REFERENCES "post"("id") ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY KEY("id" AUTOINCREMENT)
);
DROP TABLE IF EXISTS "interesting_comment";
CREATE TABLE IF NOT EXISTS "interesting_comment" (
	"user_id"	INTEGER,
	"comment_id"	INTEGER,
	FOREIGN KEY("user_id") REFERENCES "user"("id") ON UPDATE CASCADE ON DELETE NO ACTION,
	PRIMARY KEY("user_id","comment_id"),
	FOREIGN KEY("comment_id") REFERENCES "comment"("id") ON UPDATE CASCADE ON DELETE CASCADE
);
DROP TABLE IF EXISTS "post";
CREATE TABLE IF NOT EXISTS "post" (
	"id"	INTEGER,
	"text"	TEXT NOT NULL CHECK(length("text") > 0),
	"max_comments"	INTEGER CHECK("max_comments" >= 0),
	"pub_timestamp"	INTEGER NOT NULL CHECK("pub_timestamp" >= 0),
	"author_id"	INTEGER NOT NULL,
	"title"	TEXT NOT NULL UNIQUE,
	PRIMARY KEY("id" AUTOINCREMENT),
	FOREIGN KEY("author_id") REFERENCES "user"("id") ON UPDATE CASCADE ON DELETE NO ACTION
);
COMMIT;
-- INSERT INTO "user" ("id","username","email","password_hash","salt","totp_secret","is_admin") VALUES (1,'alice','alice@example.com','95f4fc2a1d23dd9d27eaa2c5eff56b43fbdd739797c6a13fba36f67e51a4489f','salt1','totp1',1),
--  (2,'bob','bob@example.com','hash2','salt2','totp2',0),
--  (3,'charlie','charlie@example.com','hash3','salt3',NULL,0),
--  (4,'diana','diana@example.com','hash4','salt4','totp4',0),
--  (5,'eve','eve@example.com','hash5','salt5',NULL,0),
--  (6,'frank','frank@example.com','hash6','salt6','totp6',1),
--  (7,'grace','grace@example.com','hash7','salt7',NULL,0),
--  (8,'henry','henry@example.com','hash8','salt8','totp8',0),
--  (9,'iris','iris@example.com','hash9','salt9',NULL,1),
--  (10,'jack','jack@example.com','hash10','salt10','totp10',0),
--  (11,'kate','kate@example.com','hash11','salt11',NULL,0),
--  (12,'liam','liam@example.com','hash12','salt12','totp12',0);
-- INSERT INTO "comment" ("id","author_id","post_id","pub_timestamp","text") VALUES (3,1,2,1650000800,'Interesting perspective, Bob.'),
--  (4,1,3,1650000900,'Hi Charlie!'),
--  (5,4,4,1650002100,'Thanks for the security tips!'),
--  (6,2,4,1650002150,'Helpful info, Diana.'),
--  (7,5,2,1650002200,'I like your ideas, Bob.'),
--  (8,6,6,1650004500,'Admin life is hard sometimes.'),
--  (9,1,6,1650004600,'You got this, Frank.'),
--  (10,3,6,1650004700,'Thanks for sharing your insights.'),
--  (12,6,6,1650004900,'Replying to myself... is this allowed?'),
--  (13,7,1,1650005100,'Welcome Alice! Great to see the community growing.'),
--  (14,8,1,1650005200,'Nice first post!'),
--  (15,NULL,1,1650005300,'Anonymous user here - love the welcoming atmosphere!'),
--  (16,NULL,1,1650005400,'Another anonymous comment - this place seems friendly.'),
--  (17,2,2,1650005500,'Adding more thoughts to my own post...'),
--  (18,2,2,1650005600,'Actually, let me clarify something I said earlier.'),
--  (19,2,2,1650005700,'One more thing - forgot to mention AI impact on jobs.'),
--  (20,1,7,1650005800,'Welcome Grace! Admin here, happy to have you.'),
--  (21,6,7,1650005900,'Another admin welcoming you! Great to have new members.'),
--  (22,7,7,1650006000,'Thanks everyone! Grace commenting on her own post.'),
--  (23,NULL,7,1650006100,'Anonymous user - this community is so welcoming!'),
--  (24,10,8,1650006200,'Sounds amazing! I love hiking too.'),
--  (25,10,8,1650006300,'Where exactly did you go? I want to try that trail.'),
--  (26,10,8,1650006400,'Also, what gear do you recommend for beginners?'),
--  (27,8,8,1650006500,'Henry replying to his own post with gear recommendations.'),
--  (28,2,9,1650007100,'Thanks for the reminder, admin!'),
--  (29,3,9,1650007200,'Good to have clear guidelines.'),
--  (30,NULL,9,1650007300,'Anonymous - totally agree with these rules!'),
--  (31,1,10,1650008100,'AI is indeed everywhere! Even in admin tools now.'),
--  (32,7,10,1650008200,'As a photographer, AI is changing image editing too.'),
--  (33,12,10,1650008300,'AI helps with recipe suggestions in cooking apps!'),
--  (34,NULL,10,1650008400,'Anonymous tech enthusiast here - excited about these trends!'),
--  (35,10,10,1650008500,'Jack adding more thoughts to his own tech post.'),
--  (36,11,11,1650009100,'Kate here adding one more book recommendation to my own list.'),
--  (37,2,11,1650009200,'Great list! I''ve read three of these.'),
--  (38,NULL,11,1650009300,'Anonymous reader - thanks for the recommendations!'),
--  (39,12,12,1650010100,'Update: the sourdough turned out great! Liam commenting on own post.'),
--  (40,5,12,1650010200,'Would love the recipe! Eve here.'),
--  (41,7,12,1650010300,'Cooking and photography go well together!'),
--  (42,8,13,1650011100,'Thanks Grace! This will help with my outdoor photography.'),
--  (43,NULL,13,1650011200,'Anonymous photographer - these tips are gold!'),
--  (44,1,13,1650011300,'Admin here - might use these for site photos.'),
--  (45,7,14,1650012100,'Henry, you should try photographing while climbing!'),
--  (46,10,14,1650012200,'Sounds terrifying but exciting!'),
--  (47,8,14,1650012300,'Henry adding safety tips to his own climbing post.'),
--  (48,2,15,1650013100,'Thanks for the heads up, Alice!'),
--  (49,6,15,1650013200,'Frank here - we appreciate your patience during maintenance.'),
--  (50,NULL,15,1650013300,'Anonymous - good to know about the downtime.'),
--  (51,1,16,1650014100,'Python for admin scripts, definitely!'),
--  (52,8,16,1650014200,'I use JavaScript for web stuff.'),
--  (53,12,16,1650014300,'SQL for database work, obviously!'),
--  (54,NULL,16,1650014400,'Anonymous developer - loving Rust lately!'),
--  (55,10,16,1650014500,'Jack here - I should have mentioned my favorite: Go!'),
--  (56,10,16,1650014600,'Actually, let me also mention TypeScript... Jack again.'),
--  (57,2,17,1650015100,'Bon courage with your French studies!'),
--  (58,NULL,17,1650015200,'Anonymous French speaker - you''re doing great!'),
--  (59,11,17,1650015300,'Kate here - thanks for the encouragement!'),
--  (60,5,18,1650016100,'Gardening is so rewarding! Good luck with the tomatoes.'),
--  (61,12,18,1650016200,'Liam updating: first tomato harvested today!'),
--  (62,NULL,18,1650016300,'Anonymous gardener - excited to see the results!');
-- INSERT INTO "interesting_comment" ("user_id","comment_id") VALUES (1,1),
--  (2,3),
--  (3,2),
--  (4,5),
--  (5,6),
--  (2,9),
--  (3,10),
--  (6,11),
--  (6,12),
--  (1,4),
--  (1,15),
--  (2,15),
--  (3,15),
--  (4,15),
--  (5,15),
--  (6,15),
--  (7,15),
--  (8,15),
--  (9,15),
--  (10,15),
--  (1,20),
--  (2,20),
--  (3,20),
--  (7,23),
--  (8,23),
--  (9,23),
--  (1,31),
--  (7,31),
--  (12,31),
--  (2,34),
--  (5,34),
--  (11,34),
--  (8,43),
--  (10,43),
--  (1,43),
--  (1,54),
--  (8,54),
--  (12,54),
--  (2,58),
--  (11,58),
--  (7,58),
--  (5,39),
--  (7,39),
--  (8,39),
--  (10,27),
--  (11,27),
--  (12,27),
--  (1,49),
--  (2,49),
--  (3,49);
-- INSERT INTO "post" ("id","text","max_comments","pub_timestamp","author_id","title") VALUES (1,'This is Alice''s first post.',10,1650000000,1,'Welcome Post'),
--  (2,'Bob shares his thoughts on the future of technology and innovation.',15,1650000500,2,'Bob''s Tech Vision'),
--  (3,'Charlie''s announcement.',NULL,1650001000,3,'Charlie Says Hi'),
--  (4,'Diana writes about security.',3,1650002000,4,'Security 101'),
--  (5,'Eve shares a recipe.',0,1650003000,5,'Eve''s Secret Pie'),
--  (6,' Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam condimentum lectus tellus, vitae cursus massa volutpat quis. Maecenas posuere augue arcu, vitae imperdiet tortor porta in. Morbi id libero sem. Sed gravida metus at massa fringilla malesuada. Ut ultricies ipsum nec ante tristique, placerat placerat enim ornare. Vivamus eleifend interdum dui vitae gravida. Cras pharetra elementum magna. In molestie enim sed dui lobortis, vitae malesuada sapien tempor. Aliquam facilisis varius auctor. Vestibulum a diam sodales, varius tellus id, maximus tortor. Fusce pellentesque euismod risus eu vestibulum. Praesent sed erat sit amet nisl iaculis scelerisque. Mauris sed sodales lectus. Proin tortor tellus, molestie ac convallis a, eleifend ut sapien. Integer ullamcorper risus quis mi imperdiet, eu molestie tellus egestas. Phasellus ullamcorper scelerisque quam, varius mattis odio elementum nec.',7,1650004000,6,'Frank discusses admin duties.'),
--  (7,'Grace here! Just joined this community and loving it already. Looking forward to great discussions!',15,1650005000,7,'New Member Introduction'),
--  (8,'Henry talks about his weekend hiking adventures in the mountains. The weather was perfect!',NULL,1650006000,8,'Weekend Hiking Trip'),
--  (9,'As an admin, I want to remind everyone about our community guidelines. Please be respectful!',5,1650007000,9,'Community Guidelines Reminder'),
--  (10,'Jack shares his thoughts on the latest tech trends. AI is everywhere these days!',20,1650008000,10,'Tech Trends 2024'),
--  (11,'Kate discusses her favorite books and reading recommendations for the summer.',12,1650009000,11,'Summer Reading List'),
--  (12,'Liam posts about his cooking experiments. Today I tried making sourdough bread!',8,1650010000,12,'Cooking Adventures'),
--  (13,'Grace again with some photography tips for beginners. Lighting is everything!',NULL,1650011000,7,'Photography 101'),
--  (14,'Henry back with more outdoor adventures. This time it was rock climbing!',10,1650012000,8,'Rock Climbing Experience'),
--  (15,'Admin post about upcoming site maintenance. We will be down for 2 hours tomorrow.',3,1650013000,1,'Site Maintenance Notice'),
--  (16,'Jack is curious about everyone''s favorite programming languages. What do you prefer?',25,1650014000,10,'Programming Languages Discussion'),
--  (17,'Kate shares her experience learning a new language. French is challenging but fun!',NULL,1650015000,11,'Learning French'),
--  (18,'Liam tries his hand at gardening. My tomatoes are finally growing!',6,1650016000,12,'Garden Update');
-- COMMIT;
